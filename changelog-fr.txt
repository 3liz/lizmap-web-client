h1. Version 2.1.0 - 25 Septembre 2012

h2. Améliorations

* Traduction de l'application web et de l'interface admin en *italien* (merci à Salvatore Larosa @lrssvt)

h2. Corrections de bugs

* Meilleure prise en compte des accents dans le nom des couches
* Meilleur support des projections


h1. Version 2.0.0 - Septembre 2012

h2. Gestion des cartes par répertoire 

Cette fonctionnalité existait dans la version précédente et est reprise ici pour référence.

* *Possibilité de créer sur le serveur un ou plusieurs "répertoires" de projets*.
Un répertoire LizMap correspond exactement à un répertoire du serveur dans lequel on stocke un ou plusieurs projets QGIS (et les données liées). 
On peut donner un titre à un répertoire (Par exemple "test" pour le chemin /home/donnees/rep_test/ qui contiendrait des projets QGIS). 
LizMap permet d'accéder à une carte pour chaque projet de chaque répertoire, via une URL unique. Il est donc possible de donner un lien direct à une carte LizMap.

* *Un fichier de configuration décrit les répertoires LizMap* : chemin du répertoire sur le serveur, titre du répertoire

* *Les chemins des projets ne sont pas visible dans les URLs*.
Grâce à l'organisation par répertoire et au fichier de configuration décrivant les répertoires LizMap, l'utilisateur de LizMap n'a pas besoin de connaître le chemin sur le serveur vers le projet QGIS qu'il souhaite consulter.
Cela offre 2 avantages, le premier est d'avoir des URLs simple, le second est de cacher l'arborescence du serveur et donc de protéger le serveur.


h2. Administration

* *Ajout d'un module d'administration* qui centralise les menus de configuration de LizMap. 
Pour accéder à ce module, il faut être un utilisateur enregistré et utiliser son login et mot de passe. Ce module d'administration contient :

 * *Un menu "Lizmap"*, où il est possible de modifier la configuration directement via des formulaires.
 
  * *services* : URL du serveur QGIS, URL d'un serveur optionnel de cache de tuiles, 
  * *répertoires* : création, modification, suppression et gestion des droits d'accès.
  
 * *Un menu "Système"*, qui centralise les pages de gestion des utilisateurs, des groupes et des droits associés.

* *Plusieurs niveaux d'accès* :

 * *groupe "admins"* : 
 les utilisateurs de ce groupe ont tous les droits. Un utilisateur *admin* (mot de passe "admin") a été créé dans ce groupe. C'est en quelque sorte le super-administrateur. 
Il est possible pour les utilisateurs du groupe *admins* de créer autant de groupes que souhaité, de créer des utilisateurs, et de modifier les droits pour chaque groupe.
 
 * *groupe "lizadmins"* : 
 les utilisateurs de ce groupe peuvent configurer LizMap : gestion des services et des répertoires de projets. 
Un utilisateur *lizadmin* (mot de passe "lizadmin") a été créé dans ce groupe.


h2. Gestion des accès aux répertoires par groupe

Il est maintenant possible de protéger facilement l'accès aux projets QGIS d'un répertoire. 

* Un répertoire peut être configuré via l'admin pour être visible par un ou plusieurs groupes d'utilisateur. 
* Un utilisateur ne peut voir que les cartes contenues dans les répertoires accessibles pour les groupes auxquels il appartient. Les autres cartes sont protégées et non accessibles.
* Les services WMS et WFS ne sont pas accessibles aux clients externe (SIG, navigateur, etc.) en dehors de l'application LizMap.
* Il reste possible d'utiliser le service WMS via un client externe en passant les paramètres d'authentification de l'utilisateur (par exemple avec le menu de QGIS *Ajouter une couche WMS* )
* Un groupe *anonymous* représente les utilisateurs non connectés, c'est-à-dire les visiteurs sans login ni mot de passe qui vont sur l'application LizMap. 
On peut donner l'accès à un ou plusieurs répertoire à ce groupe *anonymous*, ce qui revient à rendre ces répertoires accessibles à tous.

Dans la version de Lizmap fournie avec l'archive, nous avons créé par exemple un groupe *Intranet Demo Group* et un utilisateur *logintranet* (mot de passe "logintranet") appartenant à ce groupe. Nous avons créé un répertoire *intranet* et configuré son accès pour que seuls les groupes administrateurs et le groupe *Intranet Demo Group* y aient accès. Pour voir la carte *montpellier_intranet*, il faut être connecté en tant que *logintranet*. Sinon on est redirigé vers la page qui liste les projets et on ne peut accéder qu'aux cartes du répertoire *montpellier*

L'administrateur de LizMap peut ainsi créer autant de groupes thématiques qu'il souhaite. Les utilisateurs de ces groupes n'auront accès qu'aux cartes des répertoires accessibles par leur groupe.


h2. Refonte de l'interface

* *Nouvelle organisation de la carte*

 * un *panneau à gauche* présente la légende et les fonds de carte. On peut masquer ce panneau.
 * un *bandeau supérieur* contient le titre du répertoire, le titre du projet et un menu (authentification)
 * une *carte* prend la place restante (avec gestion du redimensionnement de la fenêtre)
 * une *barre d'échelle* et une *vue miniature* de la carte (si elle a été configurée) sont intégrées en bas à droite.

* Le positionnement et le style des différents éléments peuvent être facilement modifiés et adaptés en fonction des besoins, via un système de thèmes (à développer)

* *Une page liste les projets de chaque répertoire accessible à l'utilisateur* :

 * seuls les répertoires accessibles sont affichés
 * *une imagette* illustre chaque projet
 * *une description* rappelle les informations du projet : titre, description, projection, emprise.



h2. Internationalisation de l'application

* *2 langues proposées* pour l'instant : le français et l'anglais
* *détection automatique de la langue* du navigateur (bascule sur l'anglais si la langue n'est pas trouvé)
* *ajout aisé de nouvelles langues*, puisque les traductions sont enregistrées dans des fichiers textes regroupées par langue.
* *basculer sur une autre langue* en passant un paramètre (lang=fr_FR ou lang=en_EN)
 

h2. Fonctionnalités de la carte en lien avec QGIS server


* *Légende* : rafraîchissement de la légende de chaque couche (ou groupe de couches) à chaque changement d'échelles.

* *Fenêtre d'information d'un objet de la carte*, accessible sur simple clic.

 * affichage d'une image lorsqu'un champ de la couche contient une URL complète vers une image stockée sur internet
 * remplacement des liens http par des liens cliquables.


h2. Moteur

* *Mise à jour de Jelix* (framework PHP utilisé pour développer le moteur de LizMap) : passage à la version 1.3.3
* *Intégration de Jelix dans l'archive téléchargeable*, ce qui facilite l'installation de LizMap et les futures montées de version
* *Réorganisation du code* en plusieurs modules ("lizmap": responsable des services web, "view" : affichage des pages et de la carte, "admin": gestion de l'administration)
* *Utilisation de bootstrap* pour mettre en forme les pages non cartographiques.
* *Utilisation de jacl2 et de jauth* pour gérer respectivement les droits et l'authentification.
* *Remplacement du fichier de configuration* lizmap/var/projects.json (au format JSON) par lizmap/var/config/lizmapConfig.ini.php (au format ini) et factorisation du code pour gérer et utiliser cette configuration.

h2. Gestion des erreurs

* Redirection vers la liste des projets si le dépôt passé est incorrect
* Redirection vers la liste des projets si le projet est incorrect (fichier QGIS non présent ou configuration manquante pour ce projet)
* Erreurs conformes aux standards des services OGC si on lance une requête WMS sur un projet protégé (non accessible par l'utilisateur courant)
