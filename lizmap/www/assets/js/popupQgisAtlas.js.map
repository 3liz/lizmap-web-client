{"version":3,"file":"../../lizmap/www/assets/js/popupQgisAtlas.js","mappings":"AAEAA,OAAOC,OAAOC,GAAG,CAEb,qBAAwB,WAEd,sBAAuBF,OAAOG,QAE9B,eAAgBH,OAAOG,OAAOC,mBAE9B,mBAAoBJ,OAAOG,QAAkD,GAAvCH,OAAOG,OAAOE,eAAeC,QAGzEC,EAAE,sBAAsBC,MAAK,WACzB,GAAsD,GAAnDD,EAAEE,MAAMC,KAAK,4BAA4BJ,OAExC,OAAO,EAEX,GAAiE,GAA9DC,EAAEE,MAAMC,KAAK,uCAAuCJ,OAEnD,OAAO,EAGX,IAAIK,EAAaJ,EAAEE,MAAMC,KAAK,6CAA6CE,MAAMC,MAAM,KACnFC,EAAUH,EAAW,GACrBI,EAAMJ,EAAW,GACjBK,EAAUL,EAAW,GAAGE,MAAM,SAAS,GAE3C,IAAI,IAAII,KAAKjB,OAAOG,OAAOE,eAAe,CACtC,IAAIa,EAAIlB,OAAOG,OAAOE,eAAeY,GACrC,GAAG,UAAWC,GACPJ,GAAWI,EAAEC,MAAMC,cAAc,CAEhC,IAAIC,EAAMC,WAAWC,KAAKC,UACtBC,QAAQC,IACRJ,WAAWC,KAAKI,mBAAmBF,QAAQG,SAE/CP,GAAO,eACPA,GAAO,uCACPA,GAAO,cACPA,GAAO,8DACPA,GAAO,WACPA,GAAO,aAAaH,EAAEW,MACtBR,GAAO,UAAUL,EACjBK,GAAO,uBAAuBN,EAAI,IAGlC,IAAIe,EAAe,GAEnB,MAAMC,EAAoB,CAAC,cAAe,sBAC1C,IAAI,MAAMC,KAASd,EAAEe,OACbF,EAAkBG,SAASF,EAAMG,MAIjCH,EAAMI,UACNN,GAAgB,uEAAuEE,EAAMG,aAAaH,EAAMG,oBAAoBH,EAAMK,SAASL,EAAMK,kBAEzJP,GAAgB,gFAAgFE,EAAMG,aAAaH,EAAMG,oBAAoBH,EAAMK,gBAAgBL,EAAMK,UAKjL,MAAMC,EAAqC,KAAjBR,EAAuB,GAAK,6EAA6ES,QAAQ,oDAAoDT,gBAE/LvB,EAAEE,MAAM+B,OAAO,gDAAkDnB,EAAM,WAAaA,EAAM,4BAA8BkB,QAAQ,iDAAmD,IAAMrB,EAAEW,MAAQ,+BAAiCX,EAAEW,MAAQ,OAASS,EAAmB,QAG1Q/B,EAAE,uCAAuCkC,OAAM,WAC3ClC,EAAEE,MAAMiC,OAAOC,QACnB,IAGApC,EAAE,6BAA6BL,GAAG,SAAS,WACvC,MAAM0C,EAAiBrC,EAAEE,MAAMoC,QAAQ,8BAA8BC,OAErE,IAAIC,EAAqB,GAEzBxC,EAAE,6BAA6BC,MAAK,WAChCuC,GAAsB,IAAMxC,EAAEE,MAAMuC,KAAK,YAAc,IAAMC,mBAAmB1C,EAAEE,MAAMG,MAC5F,IAEAgC,EAAeM,KAAK,OAAQN,EAAeI,KAAK,QAAUD,EAC9D,IAGAxC,EAAEE,MAAMC,KAAK,iEAAiEyC,SAClF,CAER,CACJ,GACJ","sources":["webpack://assets/./src/legacy/popupQgisAtlas.js"],"sourcesContent":["\n\nlizMap.events.on({\n\n    'lizmappopupdisplayed': function(){\n\n        if( !('qgisServerPlugins' in lizMap.config) )\n            return;\n        if( !('atlasprint' in lizMap.config.qgisServerPlugins) )\n            return;\n        if( !('printTemplates' in lizMap.config) || lizMap.config.printTemplates.length == 0)\n            return;\n\n        $('div.lizmapPopupDiv').each(function(){\n            if($(this).find('a.lizmap-atlasprint-link').length != 0) {\n                // Atlas print link already exist\n                return true;\n            }\n            if($(this).find('input.lizmap-popup-layer-feature-id').length == 0) {\n                // The feature id is not found\n                return true;\n            }\n\n            var getLayerId = $(this).find('input.lizmap-popup-layer-feature-id:first').val().split('.');\n            var layerId = getLayerId[0];\n            var fid = getLayerId[1];\n            var layerName=getLayerId[0].split(/[0-9]/)[0];\n\n            for(var i in lizMap.config.printTemplates){\n                var t = lizMap.config.printTemplates[i];\n                if('atlas' in t){\n                    if(layerId == t.atlas.coverageLayer){\n                        // Build URL\n                        var url = OpenLayers.Util.urlAppend(\n                            lizUrls.wms,\n                            OpenLayers.Util.getParameterString(lizUrls.params)\n                        );\n                        url += '&SERVICE=WMS';\n                        url += '&VERSION=1.3.0&REQUEST=GetPrintAtlas';\n                        url += '&FORMAT=pdf';\n                        url += '&EXCEPTIONS=application/vnd.ogc.se_inimage&TRANSPARENT=true';\n                        url += '&DPI=100';\n                        url += '&TEMPLATE='+t.title;\n                        url += '&LAYER='+layerName;\n                        url += '&EXP_FILTER=$id IN ('+fid+')';\n\n                        // Add button and div to set custom labels\n                        let customLabels = '';\n\n                        const protectedLabelsId = [\"lizmap_user\", \"lizmap_user_groups\"];\n                        for(const label of t.labels){\n                            if (protectedLabelsId.includes(label.id)){\n                                // These values mustn't be shown in the UI and will be overridden by LWC PHP and AtlasPrint anyway\n                                continue;\n                            }\n                            if (label.htmlState){\n                                customLabels += `<textarea class=\"atlasprint-custom-labels\" cols=\"15\" data-print-id=\"${label.id}\" name=\"${label.id}\" placeholder=\"${label.text}\">${label.text}</textarea>`;\n                            }else{\n                                customLabels += `<input type=\"text\" class=\"atlasprint-custom-labels\" size=\"15\" data-print-id=\"${label.id}\" name=\"${label.id}\" placeholder=\"${label.text}\" value=\"${label.text}\">`;\n                            }\n                        }\n\n                        // Create custom labels tool if any custom labels have been defined\n                        const customLabelsTool = (customLabels === '') ? '' : `<div class=\"toggle-custom-labels-view\"><button><i class=\"icon-cog\" title=\"${lizDict['print.customLabels.tooltip']}\"></i></button><div>${customLabels}</div></div>`;\n\n                        $(this).append('<a class=\"lizmap-atlasprint-link\" data-href=\"' + url + '\" href=\"' + url + '\" target=\"_blank\" title=\"' + lizDict['attributeLayers.toolbar.btn.data.export.title'] + ' ' + t.title + '\"><span class=\"icon\"></span>' + t.title + '</a>' + customLabelsTool + '<br>');\n\n                        // Activate toggle on custom labels button\n                        $('.toggle-custom-labels-view > button').click(function () {\n                            $(this).next().toggle();\n                        });\n\n                        // Activate URL rewrite when user modify custom labels value\n                        $('.atlasprint-custom-labels').on('input', function(){\n                            const atlasPrintLink = $(this).parents('.toggle-custom-labels-view').prev();\n\n                            let customLabelsParams = '';\n\n                            $('.atlasprint-custom-labels').each(function(){\n                                customLabelsParams += '&' + $(this).data('print-id') + '=' + encodeURIComponent($(this).val());\n                            });\n\n                            atlasPrintLink.attr('href', atlasPrintLink.data('href') + customLabelsParams);\n                        });\n\n                        // Add tooltips\n                        $(this).find('a.lizmap-atlasprint-link, .toggle-custom-labels-view button i').tooltip();\n                    }\n                }\n            }\n        });\n    }\n});\n"],"names":["lizMap","events","on","config","qgisServerPlugins","printTemplates","length","$","each","this","find","getLayerId","val","split","layerId","fid","layerName","i","t","atlas","coverageLayer","url","OpenLayers","Util","urlAppend","lizUrls","wms","getParameterString","params","title","customLabels","protectedLabelsId","label","labels","includes","id","htmlState","text","customLabelsTool","lizDict","append","click","next","toggle","atlasPrintLink","parents","prev","customLabelsParams","data","encodeURIComponent","attr","tooltip"],"sourceRoot":""}