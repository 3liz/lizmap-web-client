(function(A){A.widget("ui.spinner",{_init:function(){if(A.data(this.element[0],"spinner")){return }if(this.options.init){this.options.init(this.ui(null))}this._decimals=0;if(this.options.stepping.toString().indexOf(".")!=-1){var C=this.options.stepping.toString();this._decimals=C.slice(C.indexOf(".")+1,C.length).length}var B=this;this.element.addClass("ui-spinner-box").attr("autocomplete","off");this._setValue(isNaN(this._getValue())?this.options.start:this._getValue());this.element.wrap("<div>").parent().addClass("ui-spinner").append('<button class="ui-spinner-up" type="button">&#9650;</button>').find(".ui-spinner-up").bind("mousedown",function(D){A(this).addClass("ui-spinner-pressed");if(!B.counter){B.counter=1}B._mousedown(100,"_up",D)}).bind("mouseup",function(D){A(this).removeClass("ui-spinner-pressed");if(B.counter==1){B._up(D)}B._mouseup(D)}).bind("mouseout",function(D){A(this).removeClass("ui-spinner-pressed");B._mouseup(D)}).bind("dblclick",function(D){A(this).removeClass("ui-spinner-pressed");B._up(D)}).bind("keydown.spinner",function(E){var D=A.keyCode;if(E.keyCode==D.SPACE||E.keyCode==D.ENTER){A(this).addClass("ui-spinner-pressed");if(!B.counter){B.counter=1}B._up.call(B,E)}else{if(E.keyCode==D.DOWN||E.keyCode==D.RIGHT){B.element.siblings(".ui-spinner-down").focus()}else{if(E.keyCode==D.LEFT){B.element.focus()}}}}).bind("keyup.spinner",function(D){A(this).removeClass("ui-spinner-pressed");B.counter=0;B._propagate("change",D)}).end().append('<button class="ui-spinner-down" type="button">&#9660;</button>').find(".ui-spinner-down").bind("mousedown",function(D){A(this).addClass("ui-spinner-pressed");if(!B.counter){B.counter=1}B._mousedown(100,"_down",D)}).bind("mouseup",function(D){A(this).removeClass("ui-spinner-pressed");if(B.counter==1){B._down()}B._mouseup(D)}).bind("mouseout",function(D){A(this).removeClass("ui-spinner-pressed");B._mouseup(D)}).bind("dblclick",function(D){A(this).removeClass("ui-spinner-pressed");B._down(D)}).bind("keydown.spinner",function(E){var D=A.keyCode;if(E.keyCode==D.SPACE||E.keyCode==D.ENTER){A(this).addClass("ui-spinner-pressed");if(!B.counter){B.counter=1}B._down.call(B,E)}else{if(E.keyCode==D.UP||E.keyCode==D.LEFT){B.element.siblings(".ui-spinner-up").focus()}}}).bind("keyup.spinner",function(D){A(this).removeClass("ui-spinner-pressed");B.counter=0;B._propagate("change",D)}).end();this._items=this.element.children().length;if(this._items>1){this.element.addClass("ui-spinner-list").css("height",this.element.outerHeight()/this._items).children().addClass("ui-spinner-listitem").end().parent().css("height",this.element.outerHeight()).end();this.options.stepping=1;this.options.min=0;this.options.max=this._items-1}this.element.bind("keydown.spinner",function(D){if(!B.counter){B.counter=1}return B._keydown.call(B,D)}).bind("keyup.spinner",function(D){B.counter=0;B._propagate("change",D)}).bind("blur.spinner",function(D){B._cleanUp()});if(A.fn.mousewheel){this.element.mousewheel(function(D,E){B._mousewheel(D,E)})}},_constrain:function(){if(this.options.min!=undefined&&this._getValue()<this.options.min){this._setValue(this.options.min)}if(this.options.max!=undefined&&this._getValue()>this.options.max){this._setValue(this.options.max)}},_cleanUp:function(){this._setValue(this._getValue());this._constrain()},_spin:function(C,B){if(this.disabled){return }if(isNaN(this._getValue())){this._setValue(this.options.start)}this._setValue(this._getValue()+(C=="up"?1:-1)*(this.options.incremental&&this.counter>100?(this.counter>200?100:10):1)*this.options.stepping);this._animate(C);this._constrain();if(this.counter){this.counter++}this._propagate("spin",B)},_down:function(B){this._spin("down",B);this._propagate("down",B)},_up:function(B){this._spin("up",B);this._propagate("up",B)},_mousedown:function(C,E,D){var B=this;C=C||100;if(this.timer){window.clearInterval(this.timer)}this.timer=window.setInterval(function(){B[E](D);if(B.counter>20){B._mousedown(20,E,D)}},C)},_mouseup:function(B){this.counter=0;if(this.timer){window.clearInterval(this.timer)}this.element[0].focus();this._propagate("change",B)},_keydown:function(C){var B=A.keyCode;if(C.keyCode==B.UP){this._up(C)}if(C.keyCode==B.DOWN){this._down(C)}if(C.keyCode==B.HOME){this._setValue(this.options.min||this.options.start)}if(C.keyCode==B.END&&this.options.max!=undefined){this._setValue(this.options.max)}return(C.keyCode==B.TAB||C.keyCode==B.BACKSPACE||C.keyCode==B.LEFT||C.keyCode==B.RIGHT||C.keyCode==B.PERIOD||C.keyCode==B.NUMPAD_DECIMAL||C.keyCode==B.NUMPAD_SUBTRACT||(C.keyCode>=96&&C.keyCode<=105)||(/[0-9\-\.]/).test(String.fromCharCode(C.keyCode)))?true:false},_mousewheel:function(B,C){C=(A.browser.opera?-C/Math.abs(C):C);C>0?this._up(B):this._down(B);B.preventDefault()},_getValue:function(){return parseFloat(this.element.val().replace(/[^0-9\-\.]/g,""))},_setValue:function(B){if(isNaN(B)){B=this.options.start}this.element.val(this.options.currency?A.ui.spinner.format.currency(B,this.options.currency):A.ui.spinner.format.number(B,this._decimals))},_animate:function(B){if(this.element.hasClass("ui-spinner-list")&&((B=="up"&&this._getValue()<=this.options.max)||(B=="down"&&this._getValue()>=this.options.min))){this.element.animate({marginTop:"-"+this._getValue()*this.element.outerHeight()},{duration:"fast",queue:false})}},_addItem:function(B){if(!this.element.is("input")){var C="div";if(this.element.is("ol")||this.element.is("ul")){C="li"}this.element.append("<"+C+' class="ui-spinner-dyn">'+B+"</"+C+">")}},plugins:{},ui:function(B){return{options:this.options,element:this.element,value:this._getValue(),add:this._addItem}},_propagate:function(C,B){A.ui.plugin.call(this,C,[B,this.ui()]);return this.element.triggerHandler(C=="spin"?C:"spin"+C,[B,this.ui()],this.options[C])},destroy:function(){if(!A.data(this.element[0],"spinner")){return }if(A.fn.mousewheel){this.element.unmousewheel()}this.element.removeClass("ui-spinner-box ui-spinner-list").removeAttr("disabled").removeAttr("autocomplete").removeData("spinner").unbind(".spinner").siblings().remove().end().children().removeClass("ui-spinner-listitem").remove(".ui-spinner-dyn").end().parent().removeClass("ui-spinner ui-spinner-disabled").before(this.element.clone()).remove().end()},enable:function(){this.element.removeAttr("disabled").siblings().removeAttr("disabled").parent().removeClass("ui-spinner-disabled");this.disabled=false},disable:function(){this.element.attr("disabled",true).siblings().attr("disabled",true).parent().addClass("ui-spinner-disabled");this.disabled=true}});A.extend(A.ui.spinner,{defaults:{stepping:1,start:0,incremental:true,currency:false},format:{number:function(B,C){return this.round(B,C)},currency:function(C,B){return(C!==Math.abs(C)?"-":"")+B+this.round(Math.abs(C),2)},round:function(B,D){var C=Math.round(parseFloat(B)*Math.pow(10,D))/Math.pow(10,D);if(D>0){C=C+((C.toString().indexOf(".")==-1)?".":"")+"0000000001";C=C.substr(0,C.indexOf(".")+1+D)}else{C=Math.round(C)}return C}}})})(jQuery)